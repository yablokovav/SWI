# SWI

## Описание
Данный проект реализует модуль обработки сейсмических данных методом SWI (Sufrace Waves Inversion).
Программный модуль SWI позволяет обрабатывать 2D и 3D данные сейсморазведки и строить 2D и 3D модели скорости S-волны.
Обработка включает этапы препроцессинга, спектрального анализа, инверсии и построцессинга.

Перечень и описание входных параметров доступно по ссылке:
https://clck.ru/3LDvC9

## Функциональные возможности:
Препроцессинг:
Опциональная выборка сейсмограмм по заданным критериям (диапазон номеров источника, шаг по номерам источника)
2.	Разделение данных по секторам окружности с центром в источнике (только для 3Д) с возможностью задания количества секторов;
3.	Выбор сейсмотрасс по заданными минимальным и максимальным удалениям;
4.	Отбраковка сейсмограмм по SNR и количеству трасс (если меньше минимально необходимого, заданного пользователем).
5.	Расчет координат привязки результата инверсии;
6.	Запись лог-файла с результатами предварительной обработки (количество предобработанных и отбракованных сейсмограмм).

Спектральный анализ данных: 
1.	Подход на основе двумерного преобразования Фурье (FKT);
2.	Подход на основе преобразования Стоквелла (SFK). Подход SFK обеспечивает дополнительную фильтрацию данных во временно-частотной области и усиление сигнала поверхностной волны. Предусмотреть возможность распараллеливания вычислений по ядрам CPU.
3.	Автоматическое извлечение дисперсионных кривых в двух вариантах: 1) определение максимума амплитуды для заданного пользователем диапазона фазовых скоростей и набора частот (диапазоны задаются через конфигурационного файл). 2) определение дисперсионной кривой на основе применения алгоритма DBSCAN для кластеризации спектрального изображения и выделения области преобладания амплитуд дисперсионной кривой из фонового шума. 
3.	Запись файла-журнала (лог-файла) с информацией о количестве извлеченных и отбракованных дисперсионных кривых.

Инверсия:
1.	Инверсия дисперсионных кривых поверхностных волн методом локальной оптимизации – алгоритмом Оккама. Результат инверсии – одномерная гладкая модель скорости поперечной волны в зависимости от глубины. Оптимизация осуществляется методом градиентного спуска, где на каждой итерации рассчитывается маленькая добавка к начальному приближению путем минимизации функции невязки. Изменяемые параметры: количество итераций, способ уменьшения регуляризирующего множителя по итерациям, возможность учета априорных значений скорости продольной волны или отношения скорости продольной волны к скорости поперечной волны, тип поверхностной волны (Релея или Лява), тип скорости извлеченной дисперсионной кривой (фазовая или групповая).
2.	Инверсия дисперсионных кривых поверхностных волн методами глобальной оптимизации: Grey Wolf Optimizer (GWO) и Salp Swarm Algorithm (SSA). Результат инверсии – значения скорости поперечной волны и мощности для одномерной слоистой скоростной модели. В процессе инверсии количество слоев и диапазоны поиска решения могут как задаваться вручную через конфигурационный файл, так и определяться автоматически.
3.	Автоматическое определение числа слоев и диапазонов поиска решения в 3х вариантах: 1) диапазоны рассчитываются для осредненной дисперсионной кривой; 2) набор кривых разбивается на несколько классов (согласно условию, что классы достаточно различаются друг от друга по заданной метрике) и диапазоны рассчитываются в пределах одного класса; 3) для каждой кривой рассчитываются свои диапазоны поиска.
4.	Запись файла-журнала (лог-файла) с информацией о рассчитанных диапазонов и о количестве обращенных дисперсионных кривых.

Постпроцессинг:
1. Отбраковка скоростных моделей по значению порога ошибки подбора дисперсионной кривой.
2. Интерполяция восстановленных одномерных скоростных моделей в двумерные разрезы или трехмерные «кубы».
3. Сглаживание интерполированных скоростей и заполнение пропусков.
4. Сохранение скоростной модели в segy-файл. 



## Установка
Установите [Poetry](https://python-poetry.org/), следуя [официальной инструкции](
https://python-poetry.org/docs/#installing-with-pipx).

1. Убедитесь, что у вас установлен `Poetry`:
   ```bash
   poetry --version
   ```

2. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yablokov/SWI.git!
   ```

3. Перейдите в директорию проекта:
   ```bash
   cd SWI
   ```

4. Установите зависимости с помощью `Poetry`:
   ```bash
   poetry install
   ```

5. Активируйте виртуальную среду:
   ```bash
   poetry shell
   ```
   
Pre-commit хуки можно установить командой:

```bash
pre-commit install --allow-missing-config
```

Запуск обработки по этапам осуществляется через команду python 

1. Запуск препроцессинга и спектрального анализа:
   ```bash
   python _1_preprocessing_spectral_run.py
   ```

2. Запуск инверсии:
     ```bash
     poetry _2_inversion_run.py
     ```
2. Запуск постпроцессинга:
     ```bash
     poetry _3_postprocessing_run.py
     ```