# SWI

## Описание
Данный проект реализует модуль обработки сейсмических данных методом SWI (Sufrace Waves Inversion).
Программный модуль SWI позволяет обрабатывать 2D и 3D данные сейсморазведки и строить 2D и 3D модели скорости S-волны.
Обработка включает этапы препроцессинга, спектрального анализа, инверсии и построцессинга.

Перечень и описание входных параметров доступно по ссылке:
https://clck.ru/3LDvC9

## Функциональные возможности:
Препроцессинг:
Опциональная выборка сейсмограмм по заданным критериям (диапазон номеров источника, шаг по номерам источника)
2.	Разделение данных по секторам окружности с центром в источнике (только для 3Д) с возможностью задания количества секторов;
3.	Выбор сейсмотрасс по заданными минимальным и максимальным удалениям;
4.	Отбраковка сейсмограмм по SNR и количеству трасс (если меньше минимально необходимого, заданного пользователем).
5.	Расчет координат привязки результата инверсии;
6.	Запись лог-файла с результатами предварительной обработки (количество предобработанных и отбракованных сейсмограмм).

Спектральный анализ данных: 
1.	Подход на основе двумерного преобразования Фурье (FKT);
2.	Подход на основе преобразования Стоквелла (SFK). Подход SFK обеспечивает дополнительную фильтрацию данных во временно-частотной области и усиление сигнала поверхностной волны. Предусмотреть возможность распараллеливания вычислений по ядрам CPU.
3.	Автоматическое извлечение дисперсионных кривых в двух вариантах: 1) определение максимума амплитуды для заданного пользователем диапазона фазовых скоростей и набора частот (диапазоны задаются через конфигурационного файл). 2) определение дисперсионной кривой на основе применения алгоритма DBSCAN для кластеризации спектрального изображения и выделения области преобладания амплитуд дисперсионной кривой из фонового шума. 
3.	Запись файла-журнала (лог-файла) с информацией о количестве извлеченных и отбракованных дисперсионных кривых.

Инверсия:
1.	Инверсия дисперсионных кривых поверхностных волн методом локальной оптимизации – алгоритмом Оккама. Результат инверсии – одномерная гладкая модель скорости поперечной волны в зависимости от глубины. Оптимизация осуществляется методом градиентного спуска, где на каждой итерации рассчитывается маленькая добавка к начальному приближению путем минимизации функции невязки. Изменяемые параметры: количество итераций, способ уменьшения регуляризирующего множителя по итерациям, возможность учета априорных значений скорости продольной волны или отношения скорости продольной волны к скорости поперечной волны, тип поверхностной волны (Релея или Лява), тип скорости извлеченной дисперсионной кривой (фазовая или групповая).
2.	Инверсия дисперсионных кривых поверхностных волн методами глобальной оптимизации: Grey Wolf Optimizer (GWO) и Salp Swarm Algorithm (SSA). Результат инверсии – значения скорости поперечной волны и мощности для одномерной слоистой скоростной модели. В процессе инверсии количество слоев и диапазоны поиска решения могут как задаваться вручную через конфигурационный файл, так и определяться автоматически.
3.	Автоматическое определение числа слоев и диапазонов поиска решения в 3х вариантах: 1) диапазоны рассчитываются для осредненной дисперсионной кривой; 2) набор кривых разбивается на несколько классов (согласно условию, что классы достаточно различаются друг от друга по заданной метрике) и диапазоны рассчитываются в пределах одного класса; 3) для каждой кривой рассчитываются свои диапазоны поиска.
4.	Запись файла-журнала (лог-файла) с информацией о рассчитанных диапазонов и о количестве обращенных дисперсионных кривых.

Постпроцессинг:
1. Отбраковка скоростных моделей по значению порога ошибки подбора дисперсионной кривой.
2. Интерполяция восстановленных одномерных скоростных моделей в двумерные разрезы или трехмерные «кубы».
3. Сглаживание интерполированных скоростей и заполнение пропусков.
4. Сохранение скоростной модели в segy-файл. 


## Установка
1. Скачать архив:
   - в Windows - распаковать с помощью файлового менеджера(необходим 7-Zip или WinRar) или через терминал
   ```PowerShell
   "C:\Program Files\7-Zip\7z.exe" x SWI.7z
   ```
   заменить "C:\Program Files\7-Zip\7z.exe" на свой путь до исполняемого файла 7-Zip при необходимости
   - в Linux - при необходимости установить 7zip:
   ```bash
   sudo apt-get update
   sudo apt-get install unzip
   ```
   затем распаковать архив:
   ```bash
   unzip SWI.zip
   ```

2. Перейдите в директорию проекта:
   ```bash
   cd SWI
   ```

3. Установите питон:
   - в Windows - зуапустите файл python-3.10.11-amd64.exe:
   ```PowerShell
   python-3.10.11-amd64.exe /quiet InstallAllUsers=1 AssociateFiles=1 Include_doc=1 Include_pip=1 Include_test=0 AddPythonToPath=1       InstallDir="C:\Users\<User>\AppData\Local\Programs\Python\Python310"
   ```
   перезпустите терминал
   - в Linux - распакуйте архив Python-3.10.11.tgz:
   ```bash
   tar -xzf Python-3.10.11.tgz
   ```
   перейтиде в распакованный каталог
   ```bash
   cd Python-3.10.11
   ```
   сконфигурируйте сбрку:
   ```bash
   ./configure --prefix=/opt/python3.10 --enable-optimizations
   ```
   соберите python
   ```bash
   make -j$(nproc)
   ```
   установите python
   ```bash
   sudo mkdir -p /opt/python3.10
   sudo chown $USER:$USER /opt/python3.10
   make install
   ```
   добавьте в PATH:
   - откройте файл ~/.bashrc (или ~/.bash_profile, ~/.zshrc) и добавьте следующие строки в конец файла:
   ```bash
   export PATH="/opt/python3.10/bin:$PATH"
   export LD_LIBRARY_PATH="/opt/python3.10/lib:$LD_LIBRARY_PATH"
   ```
   - сохраните файл и обновите оболочку:
   ```bash
   source ~/.bashrc  # Или source ~/.bash_profile, source ~/.zshrc
   ```
4. Проверка установки: 
   - в Windows:
   ```PowerShell
   python --version
   ```
   - в Linux:
   ```bash
   python3.10 --version
   ```
   должна отобразится версия 3.10.11

5. В каталоге с проектом создайте виртуальную среду:
   ```bash
   python -m venv <venv_name>
   ```
6. Активируте виртуальную среду:
   - в Windows:
   ```PowerShell
   <venv_name>\Scripts\activate
   ```
   - в Linux:
   ```bash
   source <venv_name>/bin/activate
   ```
7. Установите все необходимые пакеты из окального каталога:
   ```bash
   pip install --no-index --find-links=./packages -r requirements.txt
   ```

## Запуск обработки
Запуск обработки по этапам осуществляется через команду python 

1. Запуск препроцессинга и спектрального анализа:
   ```bash
   python _1_preprocessing_spectral_run.py
   ```

2. Запуск инверсии:
     ```bash
     poetry _2_inversion_run.py
     ```
2. Запуск постпроцессинга:
     ```bash
     poetry _3_postprocessing_run.py
     ```
